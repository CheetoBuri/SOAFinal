<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Cafe Ordering System - Refactored</title>
    <!-- Favicon to prevent 404 requests -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23ffffff'/%3E%3Cpath d='M18 28c0-6 4-10 10-10h8c6 0 10 4 10 10s-4 10-10 10h-8c-6 0-10-4-10-10z' fill='%231a1a1a'/%3E%3Cpath d='M44 20c4 0 8 3 8 7s-3 7-8 7' stroke='%231a1a1a' stroke-width='3' fill='none'/%3E%3C/svg%3E"/>
    
    <!-- CSS Imports -->
    <link rel="stylesheet" href="frontend/css/base.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/header.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/sidebar.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/hero.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/products.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/cart.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/modal.css?v=20251205e">
    <link rel="stylesheet" href="frontend/css/landing.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/auth.css?v=20251205d">
    <link rel="stylesheet" href="frontend/css/orders.css?v=20251205b">
    <link rel="stylesheet" href="frontend/css/profile.css?v=20251205d">
    <link rel="stylesheet" href="frontend/css/settings.css?v=20251205-2">
    <link rel="stylesheet" href="frontend/css/dark-mode.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/responsive.css?v=20251205">
    <link rel="stylesheet" href="frontend/css/reviews.css?v=20251205">
</head>
<body>
    <!-- ========== LANDING PAGE ========== -->
    <div id="landingPage" class="landing-container">
        <div class="landing-content">
            <div class="landing-logo">‚òï</div>
            <h1 class="landing-title">Welcome to Our Cafe Ordering Website</h1>
            <p class="landing-subtitle">Experience the finest coffee and treats, delivered to your door</p>
            <button class="btn-order-now" onclick="showAuthScreen()">Order Now</button>
        </div>
        <div class="landing-background">
            <div class="coffee-bean bean1">‚òï</div>
            <div class="coffee-bean bean2">‚òï</div>
            <div class="coffee-bean bean3">‚òï</div>
        </div>
    </div>

    <!-- ========== AUTH SCREEN ========== -->
    <div id="authScreen" class="auth-container" style="display: none;">
        <div class="auth-box">
            <h2>‚òï Cafe Order</h2>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
                <button class="auth-tab" onclick="switchAuthTab('forgot')">Forgot Password</button>
            </div>

            <!-- LOGIN FORM -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div id="loginError"></div>
                <div class="form-group">
                    <label>Email or Username</label>
                    <input type="text" id="loginEmail" required placeholder="your@email.com or username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="password-field">
                        <input type="password" id="loginPassword" required placeholder="Enter password">
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPassword')">üëÅÔ∏è</button>
                    </div>
                </div>
                <div class="forgot-password-link">
                    <a onclick="switchAuthTab('forgot')">Forgot password?</a>
                </div>
                <button type="submit" class="auth-submit">Login</button>
            </form>

            <!-- REGISTER FORM -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div id="registerError"></div>
                <div id="registerSuccess"></div>

                <div id="registerStep1">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" required placeholder="your@email.com">
                    </div>
                    <button type="button" class="auth-submit" onclick="sendOTP()">Send OTP Code</button>
                </div>

                <div id="registerStep2" style="display:none;">
                    <div class="otp-sent-message">‚úÖ OTP code sent to your email! Check spam folder if not found.</div>
                    <div class="form-group">
                        <label>OTP Code (6 digits)</label>
                        <input type="text" id="otpCode" maxlength="6" placeholder="000000">
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="registerName" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label>Username (Optional)</label>
                        <input type="text" id="registerUsername" placeholder="Username for login">
                    </div>
                    <div class="form-group">
                        <label>Phone (Optional)</label>
                        <input type="tel" id="registerPhone" placeholder="Your phone (optional)">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-field">
                            <input type="password" id="registerPassword" placeholder="Create a strong password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('registerPassword')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <div class="password-field">
                            <input type="password" id="registerPasswordConfirm" placeholder="Confirm password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('registerPasswordConfirm')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <button type="submit" class="auth-submit">Create Account</button>
                    <button type="button" class="auth-submit" style="background:#999; margin-block-start:8px;" onclick="resetRegisterForm()">Back</button>
                </div>
            </form>

            <!-- FORGOT PASSWORD FORM -->
            <form id="forgotForm" class="auth-form" onsubmit="handleForgotPassword(event)">
                <div id="forgotError"></div>
                
                <div id="forgotStep1">
                    <p style="color:#666; font-size:14px; margin-block-end:15px;">Enter your email to reset password</p>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="forgotEmail" required placeholder="your@email.com">
                    </div>
                    <button type="button" class="auth-submit" onclick="sendForgotOTP()">Send OTP Code</button>
                </div>

                <div id="forgotStep2" style="display:none;">
                    <div class="otp-sent-message">‚úÖ OTP code sent to your email!</div>
                    <div class="form-group">
                        <label>OTP Code</label>
                        <input type="text" id="forgotOTP" maxlength="6" placeholder="000000">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <div class="password-field">
                            <input type="password" id="forgotNewPassword" placeholder="Create new password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('forgotNewPassword')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <div class="password-field">
                            <input type="password" id="forgotConfirmPassword" placeholder="Confirm password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('forgotConfirmPassword')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <button type="submit" class="auth-submit">Reset Password</button>
                    <button type="button" class="auth-submit" style="background:#999; margin-block-start:8px;" onclick="resetForgotForm()">Back</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== MAIN APP ========== -->
    <div id="appScreen" style="display:none;">
        <!-- HEADER -->
        <header>
            <div class="header-logo">
                <span class="logo-icon">‚òï</span>
                <span class="logo-text">Cafe Ordering System</span>
            </div>
            
            <!-- HEADER SEARCH -->
            <div class="header-search">
                <input type="text" class="header-search-input" id="headerSearchInput" placeholder="Search menu..." onkeyup="handleSearch()">
                <div id="headerSearchResults" class="header-search-results" style="display:none;">
                    <div id="headerSearchResultsList"></div>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="icon-btn" onclick="switchView('shop')" title="Home Menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
                <button class="icon-btn" onclick="switchView('orderStatus')" title="Order Status">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="9" y1="9" x2="15" y2="9"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                </button>
                <button class="icon-btn" onclick="switchView('history')" title="Order History">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </button>
                <button class="icon-btn" onclick="switchView('favorites')" title="Favorites">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                </button>
                <div class="user-dropdown-container">
                    <button class="icon-btn" onclick="toggleUserDropdown()" id="userDropdownBtn" title="Profile">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" style="justify-content: space-between;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <span>Theme</span>
                            </div>
                            <label class="theme-toggle">
                                <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <button class="dropdown-item" onclick="openSettingsModal(event);">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m-2.84 2.84l-4.24 4.24M1 12h6m6 0h6M5.34 5.34l4.24 4.24m2.84 2.84l4.24 4.24"></path>
                            </svg>
                            <span>Settings</span>
                        </button>
                        <button class="dropdown-item logout" onclick="logout()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <div class="container">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <!-- SHOP & FAVORITES CONTROLS -->
                <div id="shopControls">
                    <!-- CATEGORIES -->
                    <div class="sidebar-section">
                        <h3>üìÇ Categories</h3>
                        <button class="category-btn active" onclick="filterByCategory('all', event)">All</button>
                        <button class="category-btn" onclick="filterByCategory('coffee', event)">‚òï Coffee</button>
                        <button class="category-btn" onclick="filterByCategory('tea', event)">üçµ Tea</button>
                        <button class="category-btn" onclick="filterByCategory('juice', event)">üßÉ Juice</button>
                        <button class="category-btn" onclick="filterByCategory('food', event)">üç∞ Food</button>
                    </div>
                    
                    <!-- FREQUENT ITEMS -->
                    <div class="sidebar-section">
                        <h3>üî• Frequent Items</h3>
                        <div id="frequentItemsList" class="frequent-items-list">
                            <p style="color:#999; font-size:12px; text-align:center;">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAIN CONTENT AREA -->
            <div class="main-content">
                <!-- SHOP VIEW -->
                <div id="shopView" class="view active">
                    <!-- HERO SECTION -->
                    <div class="hero-section">
                        <div class="hero-content">
                            <h1 class="hero-title">Coffee, Perfected.</h1>
                            <p class="hero-subtitle">Crafted freshness. Delivered fast.</p>
                            <button class="hero-btn" onclick="document.getElementById('productsGrid').scrollIntoView({behavior: 'smooth'})">Order Now ‚Üí</button>
                        </div>
                        <div class="hero-image">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Ccircle cx='200' cy='200' r='180' fill='%23f5f5f5'/%3E%3Cellipse cx='200' cy='280' rx='120' ry='20' fill='%23e0e0e0'/%3E%3Cpath d='M120 180 Q120 120 180 120 L220 120 Q280 120 280 180 Q280 240 220 280 L180 280 Q120 240 120 180' fill='%23fff' stroke='%23333' stroke-width='3'/%3E%3Cpath d='M140 180 Q140 140 180 140 L220 140 Q260 140 260 180 Q260 220 220 250 L180 250 Q140 220 140 180' fill='%23654321'/%3E%3Cellipse cx='200' cy='170' rx='50' ry='20' fill='%238B6F47' opacity='0.5'/%3E%3Cpath d='M280 140 Q320 120 340 140 Q360 160 340 180 Q320 200 280 180 Z' fill='%23fff' stroke='%23333' stroke-width='3'/%3E%3C/svg%3E" alt="Coffee Cup">
                        </div>
                    </div>
                    
                    <div id="productsGrid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>

                <!-- ORDER HISTORY VIEW -->
                <div id="historyView" class="view">
                    <h2 style="color:#006241; margin-block-end:20px;">üìú Your Orders</h2>
                    <div class="order-list" id="ordersList">
                        <p style="color:#999;">Loading orders...</p>
                    </div>
                </div>

                <!-- FAVORITES VIEW -->
                <div id="favoritesView" class="view">
                    <h2>‚ù§Ô∏è Your Favorites</h2>
                    <div id="favoritesGrid">
                        <p style="color:#999;">No favorites yet. Add some from the shop!</p>
                    </div>
                </div>

                <!-- ORDER STATUS VIEW -->
                <div id="orderStatusView" class="view">
                    <h2 style="color:#006241; margin-block-end:20px;">üì¶ Order Status</h2>
                    <div id="orderStatusList" class="orders-list">
                        <p style="text-align:center; color:#999; padding:40px;">No active orders</p>
                    </div>
                </div>
            </div>

            <!-- CART SIDEBAR -->
            <div class="cart-sidebar">
                <div class="cart-title">üõí Cart</div>
                <div id="cartItems">
                    <div class="cart-empty">Cart is empty</div>
                </div>
                <div class="cart-summary" id="cartSummary" style="display:none;">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">‚Ç´0</span>
                    </div>
                    <div class="summary-row" id="discountRow" style="display:none;">
                        <span>Discount:</span>
                        <span id="discountAmount">-‚Ç´0</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="totalPrice">‚Ç´0</span>
                    </div>
                    <button class="checkout-btn" onclick="openCheckoutModal()">Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCheckoutModal()" aria-label="Close">√ó</button>
            <div class="modal-header">üõí Checkout</div>
            <form onsubmit="processCheckout(event)">
                <div class="form-group">
                    <label>Customer Name *</label>
                    <input type="text" id="customerName" required placeholder="Your full name">
                </div>
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="customerPhone" required placeholder="Your phone number">
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="customerEmail" required placeholder="Your email">
                </div>
                <div class="form-group">
                    <label>District / Qu·∫≠n *</label>
                    <select id="deliveryDistrict" required onchange="loadWards()">
                        <option value="">Choose district...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ward / Ph∆∞·ªùng *</label>
                    <select id="deliveryWard" required>
                        <option value="">Choose ward...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Street Address *</label>
                    <input type="text" id="deliveryStreet" required placeholder="123 Nguy·ªÖn Hu·ªá">
                </div>
                <div class="form-group">
                    <label>Payment Method *</label>
                    <select id="paymentMethod" required>
                        <option value="">Choose payment method...</option>
                        <option value="balance">Account Balance</option>
                        <option value="cash">Cash on Delivery</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Special Notes (Optional)</label>
                    <textarea id="specialNotes" rows="3" placeholder="Any special requests? (e.g., less sugar, no ice)"></textarea>
                </div>
                
                <!-- Order Items Summary -->
                <div id="checkoutOrderItems" style="background:#fff; border:1px solid #ddd; border-radius:8px; padding:15px; margin:15px 0; max-block-size:200px; overflow-y:auto;">
                    <h4 style="margin:0 0 10px 0; color:#006241; font-size:16px;">üìã Order Items</h4>
                    <div id="checkoutItemsList"></div>
                </div>
                
                <div id="checkoutSummary" style="background:#f5f5f5; padding:15px; border-radius:8px; margin:15px 0;">
                    <div style="display:flex; justify-content:space-between; margin-block-end:8px;">
                        <span>Subtotal:</span>
                        <span id="checkoutSubtotal">‚Ç´0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-block-end:8px;">
                        <span>Discount:</span>
                        <span id="checkoutDiscount">-‚Ç´0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:18px; color:#c41e3a; padding-block-start:8px; border-block-start:2px solid #ddd;">
                        <span>Total:</span>
                        <span id="checkoutTotal">‚Ç´0</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-submit">Place Order</button>
                    <button type="button" class="btn-cancel" onclick="closeCheckoutModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Profile Modals -->
    <!-- REVIEW MODAL -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeReviewModal()">√ó</button>
            <h3 class="modal-header">üåü Write a Review</h3>
            
            <form onsubmit="submitReview(document.getElementById('reviewProductId').value, document.getElementById('reviewRating').value, document.getElementById('reviewText').value); return false;">
                <div class="form-group">
                    <label>Rating</label>
                    <div class="star-rating">
                        <input type="hidden" id="reviewRating" value="5">
                        <div class="stars-input">
                            <button type="button" class="star active" onclick="document.getElementById('reviewRating').value = 1; updateStarDisplay(1);">‚òÖ</button>
                            <button type="button" class="star active" onclick="document.getElementById('reviewRating').value = 2; updateStarDisplay(2);">‚òÖ</button>
                            <button type="button" class="star active" onclick="document.getElementById('reviewRating').value = 3; updateStarDisplay(3);">‚òÖ</button>
                            <button type="button" class="star active" onclick="document.getElementById('reviewRating').value = 4; updateStarDisplay(4);">‚òÖ</button>
                            <button type="button" class="star active" onclick="document.getElementById('reviewRating').value = 5; updateStarDisplay(5);">‚òÖ</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Your Review (Optional)</label>
                    <textarea id="reviewText" placeholder="Share your experience..." maxlength="500" style="min-height: 100px;"></textarea>
                </div>
                
                <div class="modal-buttons">
                    <button type="submit" class="btn-submit">Submit Review</button>
                    <button type="button" class="btn-cancel" onclick="closeReviewModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <input type="hidden" id="reviewProductId">
                </div>
            </form>
        </div>
    </div>

    <!-- ========== NEW SETTINGS SYSTEM ========== -->
    <!-- Settings Modal (Popup) -->
    <div id="settingsModal" class="modal-overlay" onclick="closeSettingsModal(event)">
        <div class="modal-popup" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Settings</h3>
                <button class="modal-close-btn" onclick="closeSettingsModal()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <div class="settings-section">
                <h3>ACCOUNT DETAILS</h3>
                <button class="settings-item" onclick="openPersonalInfoModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <span>Personal Information</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <!-- Moved from Personal Info modal: account change actions -->
                <button class="settings-item" onclick="settingsOpenChangeEmailModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </div>
                    <span>Change Email</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <button class="settings-item" onclick="settingsOpenChangePhoneModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </div>
                    <span>Change Phone</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <button class="settings-item" onclick="settingsOpenChangeUsernameModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <span>Change Username</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <button class="settings-item" onclick="settingsOpenChangePasswordModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </div>
                    <span>Change Password</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                <button class="settings-item" onclick="openTransactionHistoryModal()">
                    <div class="settings-item-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    <span>Transaction History</span>
                    <svg class="settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Personal Information Modal (Popup) -->
    <div id="personalInfoModal" class="modal-overlay" onclick="closePersonalInfoModal(event)">
        <div class="modal-popup" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Personal Information</h3>
                <button class="modal-close-btn" onclick="closePersonalInfoModal()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <div class="info-display">
                    <div class="info-item">
                        <span class="info-label">Email</span>
                        <span class="info-value" id="displayEmail">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Username</span>
                        <span class="info-value" id="displayUsername">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Full Name</span>
                        <span class="info-value" id="displayFullName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone</span>
                        <span class="info-value" id="displayPhone">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Balance</span>
                        <span class="info-value" id="displayBalance" style="color: var(--primary); font-weight: 700;">‚Ç´0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Member Since</span>
                        <span class="info-value" id="displayMemberSince">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction History Modal -->
    <div id="transactionHistoryModal" class="modal-overlay" onclick="closeTransactionHistoryModal(event)">
        <div class="modal-popup" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Transaction History</h3>
                <button class="modal-close-btn" onclick="closeTransactionHistoryModal()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <div id="transactionsList" class="transactions-list">
                    <p style="color:#999; text-align:center; padding:20px;">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Email Modal -->
    <div id="changeEmailModal" class="modal-overlay" onclick="closeChangeEmailModalNew(event)">
        <div class="modal-popup-small" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Change Email</h3>
                <button class="modal-close-btn" onclick="closeChangeEmailModalNew()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <form onsubmit="submitChangeEmailNew(event)">
                    <div class="form-group">
                        <label>Current Email</label>
                        <input type="email" id="currentEmailDisplay" readonly>
                    </div>
                    <div class="form-group">
                        <label>New Email</label>
                        <input type="email" id="newEmailInput" required placeholder="new@email.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="emailChangePassword" required placeholder="Enter password">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeChangeEmailModalNew()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Phone Modal -->
    <div id="changePhoneModal" class="modal-overlay" onclick="closeChangePhoneModalNew(event)">
        <div class="modal-popup-small" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Change Phone</h3>
                <button class="modal-close-btn" onclick="closeChangePhoneModalNew()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <form onsubmit="submitChangePhoneNew(event)">
                    <div class="form-group">
                        <label>Current Phone</label>
                        <input type="tel" id="currentPhoneDisplay" readonly>
                    </div>
                    <div class="form-group">
                        <label>New Phone</label>
                        <input type="tel" id="newPhoneInput" required placeholder="0123456789">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="phoneChangePassword" required placeholder="Enter password">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeChangePhoneModalNew()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Username Modal -->
    <div id="changeUsernameModal" class="modal-overlay" onclick="closeChangeUsernameModalNew(event)">
        <div class="modal-popup-small" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Change Username</h3>
                <button class="modal-close-btn" onclick="closeChangeUsernameModalNew()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <form onsubmit="submitChangeUsernameNew(event)">
                    <div class="form-group">
                        <label>Current Username</label>
                        <input type="text" id="currentUsernameDisplay" readonly>
                    </div>
                    <div class="form-group">
                        <label>New Username</label>
                        <input type="text" id="newUsernameInput" required placeholder="newusername">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="usernameChangePassword" required placeholder="Enter password">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeChangeUsernameModalNew()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal-overlay" onclick="closeChangePasswordModalNew(event)">
        <div class="modal-popup-small" onclick="event.stopPropagation()">
            <div class="modal-popup-header">
                <h3>Change Password</h3>
                <button class="modal-close-btn" onclick="closeChangePasswordModalNew()">√ó</button>
            </div>
            <div class="modal-popup-content">
                <form onsubmit="submitChangePasswordNew(event)">
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" id="currentPasswordInput" required placeholder="Current password">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="newPasswordInput" required placeholder="New password">
                    </div>
                    <div class="form-group">
                        <label>Confirm New Password</label>
                        <input type="password" id="confirmPasswordInput" required placeholder="Confirm password">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" onclick="closeChangePasswordModalNew()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Imports (ES6 Modules) -->
    <script src="frontend/js/components/reviews.js?v=20251205"></script>
    <script src="frontend/js/components/settings.js?v=20251206-timing"></script>
    <script type="module" src="frontend/js/main.js?v=2.4paymentUI"></script>
</body>
</html>
